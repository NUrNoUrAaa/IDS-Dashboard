<div class="analytics-root">

    <!-- KPIs row -->
    <div class="kpis-grid">
        <div class="card kpi-card">
            <h3>Total Traffic</h3>
            <div class="kpi-row">
                <p class="value primary">{{overview.totalTraffic}}</p>
                <div class="progress">
                    <div class="progress-fill primary" [style.width]="progressPct(Math.min(100,(overview.totalTraffic/2000)))"></div>
                </div>
            </div>
        </div>

        <div class="card kpi-card">
            <h3>Detected Attacks</h3>
            <div class="kpi-row">
                <p class="value danger">{{overview.detected}}</p>
                <div class="progress">
                    <div class="progress-fill danger" [style.width]="progressPct(Math.min(100,(overview.detected/500)*100))"></div>
                </div>
            </div>
        </div>

        <div class="card kpi-card">
            <h3>Accuracy</h3>
            <div class="kpi-row">
                <p class="value success">{{overview.accuracy}}%</p>
                <div class="progress">
                    <div class="progress-fill success" [style.width]="progressPct(overview.accuracy)"></div>
                </div>
            </div>
        </div>

        <div class="card kpi-card">
            <h3>Active Alerts</h3>
            <div class="kpi-row">
                <p class="value warn">{{overview.activeAlerts}}</p>
                <div class="progress">
                    <div class="progress-fill warn" [style.width]="progressPct(Math.min(100,overview.activeAlerts*10))"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main grid -->
    <div class="grid-main">

        <!-- Left column (charts) -->
        <div class="left-col">

            <div class="card">
                <h4>Traffic Line</h4>
                <apx-chart *ngIf="trafficChartOptions.series" [series]="trafficChartOptions.series" [chart]="trafficChartOptions.chart" [xaxis]="trafficChartOptions.xaxis" [stroke]="trafficChartOptions.stroke" [colors]="trafficChartOptions.colors" [tooltip]="trafficChartOptions.tooltip"
                    [grid]="trafficChartOptions.grid"></apx-chart>
            </div>

            <div class="card">
                <h4>Attacks Per Day (Bar)</h4>
                <apx-chart *ngIf="barChartOptions.series" [series]="barChartOptions.series" [chart]="barChartOptions.chart" [xaxis]="barChartOptions.xaxis" [plotOptions]="barChartOptions.plotOptions" [colors]="barChartOptions.colors" [grid]="barChartOptions.grid" [tooltip]="barChartOptions.tooltip"></apx-chart>
            </div>

            <div class="card">
                <h4>Detection Trend (Area)</h4>
                <apx-chart *ngIf="areaChartOptions.series" [series]="areaChartOptions.series" [chart]="areaChartOptions.chart" [xaxis]="areaChartOptions.xaxis" [stroke]="areaChartOptions.stroke" [fill]="areaChartOptions.fill" [colors]="areaChartOptions.colors" [grid]="areaChartOptions.grid"
                    [tooltip]="areaChartOptions.tooltip"></apx-chart>
            </div>

            <div class="card">
                <h4>Heatmap (Activity)</h4>
                <apx-chart *ngIf="heatmapOptions.series" [tooltip]="heatmapOptions.tooltip" [series]="heatmapOptions.series" [chart]="heatmapOptions.chart" [dataLabels]="heatmapOptions.dataLabels" [plotOptions]="heatmapOptions.plotOptions" [colors]="heatmapOptions.colors"></apx-chart>
            </div>

        </div>

        <!-- Right column -->
        <aside class="right-col">

            <div class="card">
                <h4>Attack Distribution</h4>
                <apx-chart *ngIf="donutOptions.series" [series]="donutOptions.series" [chart]="donutOptions.chart" [labels]="donutOptions.labels" [legend]="donutOptions.legend" [colors]="donutOptions.colors"></apx-chart>
            </div>

            <div class="card">
                <h4>Model Performance (Radar)</h4>
                <apx-chart *ngIf="radarOptions.series" [series]="radarOptions.series" [tooltip]="radarOptions.tooltip" [chart]="radarOptions.chart" [xaxis]="radarOptions.xaxis" [colors]="radarOptions.colors"></apx-chart>
            </div>

            <div class="card" style="text-align: center; padding: 0.1rem;">
                <h4>Recent Alerts</h4>
                <table class="alerts-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Type</th>
                            <th>Source</th>
                            <th>Severity</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let a of pagedAlerts">
                            <td class="muted">{{a.time}}</td>
                            <td>{{a.type}}</td>
                            <td>{{a.src}}</td>
                            <td>
                                <span class="badge" [ngClass]="{
                        'severity-high': a.severity === 'High',
                        'severity-medium': a.severity === 'Medium',
                        'severity-low': a.severity === 'Low'
                      }">{{a.severity}}</span>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- pagination -->
                <div class="pager">
                    <button (click)="goPage(currentPage-1)" [disabled]="currentPage===1">Prev</button>
                    <span>Page {{currentPage}} / {{totalPages}}</span>
                    <button (click)="goPage(currentPage+1)" [disabled]="currentPage===totalPages">Next</button>
                </div>
            </div>

        </aside>
    </div>
</div>
